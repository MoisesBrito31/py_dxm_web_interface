{% extends 'base.html' %}
{% load static %}
{% block context %}

<script src="{% static 'js/moment.js'%}"></script>
<script src="{% static 'js/Chart.min.js'%}"></script>
<script src="{% static 'js/Chart.js'%}"></script>
<script src="{% static 'js/chart.util.js'%}"></script>

<script src="{% static 'framework/vue/componentes/utils/input_datetime.js' %}"></script>

<div id="app">
    <main_menu></main_menu>   
    <b-container fluid>
<div class="card-title mt-5 mb-3 pt-3">
    <div class="row">
        <div class="col text-left"><h2>{{linha_nome}} - Histórico</h2></div>

        <div class="col text-right">
            <div class="btn-group">
                <button type="button" class="btn btn-primary" onclick="window.location.href='/oee'">Fábrica</button>
                <button type="button" class="btn btn-primary" onclick="window.location.href='/oee/linha/{{linha_id}}'">ao vivo</button>
                <button type="button" class="btn btn-primary disabled">Histórico</button>
                <!--<button type="button" class="btn btn-danger">Zerar</button>-->
            </div>
        </div>
    </div>
</div>
<hr>


 <b-row align-v="end" cols="1" cols-sm="1" cols-md="2" cols-lg="3"> 
     <b-col class="mb-3">
        <input_datetime id="ini" label="Inicio" value="{{ini}}" @check="processaIni"></input_datetime>
     </b-col>
     <b-col  class="mb-3">
        <input_datetime id="fim" label="Fim" value="{{fim}}" @check="processaFim"></input_datetime>
     </b-col>
     <b-col  class="mb-3">
        <b-button block v-bind:class="{disabled:!dataCheck}" variant="primary" @click="filtra" >Aplicar</b-button>
     </b-col>
</b-row>  
</b-container>
</div>

<script>

var app = new Vue({
        delimiters: ["[[", "]]"],
        el:'#app',
        created(){
            this.load()
        },
        data:{
            form: new FormData(),
            ini:"",
            fim:"",
            dataCheck:false
        },
        computed:{  
        },
        methods:{
            load(){
            },
            dataFormat(){
                const formData = new FormData()
                formData.append('ini',`${this.ini}`)
                formData.append('fim',`${this.fim}`)
                return formData
            },
            async filtra(){
                fetch(`/oee/historico/{{linha_id}}`,{
                    method: 'post',
                    headers: {
                        'X-CSRFToken': this.getCookie('csrftoken'),
                    },
                    body: this.dataFormat()
            }).then(res=>{
                if(res.status === 200){
                    document.documentElement = res.text()
                }else if(res.status===400) {
                    console.log("erro 400")
                }else{
                    throw 'Erro - servidor fora do ar '
                }
            }).then(result=>{
                 console.log(result)
            }).catch(erro=>{
                console.log(erro)
            })
            },
            processaIni(valor){
                this.ini = valor
                if(this.ini!="" && this.fim!=""){this.dataCheck=true}
                else{this.dataCheck=false}
            },
            processaFim(valor){
                this.fim=valor
                if(this.ini!="" && this.fim!=""){this.dataCheck=true}
                else{this.dataCheck=false}
            },
            getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            },
        },
    })

</script>

{% endblock %}